case "obtenercomunas":
    $idregion = intval($_GET["idregion"]); // segura conversión a número entero
    $query = "SELECT idcomuna, comuna FROM carrocompra.comuna WHERE idregion = $idregion ORDER BY comuna";
    break;




-------------
<select id="comboRegion"></select>
<select id="comboComuna"></select>




-


let BD = new BASE();
BD.commandFile = "form/training/database/ejercicio2/command.php";

// 1. Llenar comboRegion al inicio
let resultado = BD.send("cmd=obtenerdatos");

let comboRegion = document.getElementById("comboRegion");
comboRegion.innerText = null;

// Opción por defecto
let defaultRegion = document.createElement("option");
defaultRegion.value = "";
defaultRegion.text = "-- Seleccione una región --";
comboRegion.add(defaultRegion);

// Agregar opciones de regiones
for (let i = 0; i < resultado.numrows; i++) {
  let option = document.createElement("option");
  option.value = BD.getField(resultado, "idregion", i);
  option.text = BD.getField(resultado, "region", i);
  comboRegion.add(option);
}

// 2. Escuchar cambios en comboRegion y cargar comboComuna
comboRegion.addEventListener("change", function () {
  let idregion = this.value;
  let comboComuna = document.getElementById("comboComuna");
  comboComuna.innerText = null;

  // Opción por defecto para comuna
  let defaultComuna = document.createElement("option");
  defaultComuna.value = "";
  defaultComuna.text = "-- Seleccione una comuna --";
  comboComuna.add(defaultComuna);

  // Si seleccionó una región válida, cargar comunas
  if (idregion !== "") {
    let resultadoComunas = BD.send("cmd=obtenercomunas&idregion=" + idregion);

    for (let i = 0; i < resultadoComunas.numrows; i++) {
      let option = document.createElement("option");
      option.value = BD.getField(resultadoComunas, "idcomuna", i);
      option.text = BD.getField(resultadoComunas, "comuna", i);
      comboComuna.add(option);
    }
  }
});
