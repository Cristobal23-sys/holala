<script type="text/javascript">
let BD = new BASE();
BD.commandFile = "form/training/messagebox/ejercicio2/command.php";

// Instancia global del MSGBOX
let MSGBOX = new IU_MSGBOX();

// Función para cargar la tabla al iniciar
function cargarTabla() {
    var resultado = BD.send("cmd=obtienePersonal");

    let txt = `
    <table width="80%" border="1px solid #ddd" style="border-collapse:collapse;">
    <thead font-size:25px;">
    <tr style="background-color:#EAEAEA">
        <th style="font-weight:bold; padding:10px; width:100px;">Nombre</th>
        <th style="font-weight:bold; padding:10px; width:200px;">Apellidos</th>
        <th style="font-weight:bold; padding:10px; width:50px;">FechaHora</th>
        <th style="font-weight:bold; padding:10px; width:50px;">Acción</th>
    </tr>`;

    for (let x = 0; x < resultado.numrows; x++) {
        let id = BD.getField(resultado, 'idpersona', x);
        txt += `<tr>
            <td style="padding:10px;">${BD.getField(resultado, 'nombre', x)}</td>
            <td>${BD.getField(resultado, 'apellidopaterno', x)} ${BD.getField(resultado, 'apellidomaterno', x)}</td>
            <td>${BD.getField(resultado, 'fechahora', x)}</td>
            <td>
                <button onclick="confirmarEliminacion(${id})" 
                    style="background-color:#ED3D32; border-radius:5px; color:white; border:none; padding:6px; margin-left:10px; cursor:pointer;">
                    Eliminar
                </button>
            </td>
        </tr>`;
    }

    txt += `</table>`;
    document.getElementById("personal").innerHTML = txt;
}

// Función que muestra el MSGBOX de confirmación
function confirmarEliminacion(id) {
    MSGBOX.titulo = "Eliminar Registros";
    MSGBOX.texto = "<center>¿Está seguro que desea realizar esta acción?</center>";
    MSGBOX.botonera = 3; // Sí / No
    MSGBOX.fnretorno = "accionEliminar";
    MSGBOX.objeto = { idpersona: id };
    MSGBOX.Messagebox();
}

// Función que ejecuta la eliminación si se confirma
function accionEliminar(resp) {
    if (resp === "S") {
        let id = MSGBOX.objeto.idpersona;
        let respuesta = BD.send(`cmd=eliminarPersonal&idpersona=${id}`);
        cargarTabla(); // Refresca la tabla
    }
    MSGBOX.HideInfo();
}

// Ejecuta la carga inicial al abrir la página
window.onload = cargarTabla;
</script>
