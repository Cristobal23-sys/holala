let BD = new BASE();
BD.commandFile = "form/training/messagebox/ejercicio2/command.php";

// Render tabla
function cargarTabla() {
    var resultado = BD.send("cmd=obtienePersonal");
    let txt = "";

    txt += `
    <table width="80%" border="1px solid #ddd" style="border-collapse:collapse;">
    <thead font-size:25px;">
    <tr style="background-color:#EAEAEA">
        <th style="font-weight:bold; padding:10px; width:100px;">Nombre</th>
        <th style="font-weight:bold; padding:10px; width:200px;">Apellidos</th>
        <th style="font-weight:bold; padding:10px; width:50px;">FechaHora</th>
        <th style="font-weight:bold; padding:10px; width:50px;">Acción</th>
    </tr>`;

    for (let x = 0; x < resultado.numrows; x++) {
        let id = BD.getField(resultado, 'idpersona', x);
        txt += `<tr>
            <td style="padding:10px;">${BD.getField(resultado, 'nombre', x)}</td>
            <td>${BD.getField(resultado, 'apellidopaterno', x)} ${BD.getField(resultado, 'apellidomaterno', x)}</td>
            <td>${BD.getField(resultado, 'fechahora', x)}</td>
            <td>
                <button onclick="confirmarEliminacion(${id})" 
                    style="background-color:#ED3D32; border-radius:5px; color:white; border:none; padding:6px; margin-left:10px; cursor:pointer;">
                    Eliminar
                </button>
            </td>
        </tr>`;
    }

    txt += `</table>`;
    document.getElementById("personal").innerHTML = txt;
}

window.onload = cargarTabla;

// Confirmar eliminación con MSGBOX
function confirmarEliminacion(id) {
    let msgbox = new IU_MSGBOX();
    msgbox.titulo = "Eliminar Registros";
    msgbox.texto = "<center>¿Está seguro que desea realizar esta acción?</center>";
    msgbox.botonera = 3; // Sí / No
    msgbox.fnretorno = "accionEliminar";
    msgbox.objeto = { idpersona: id };
    msgbox.Messagebox();
}

// Ejecutar eliminación si usuario confirma
function accionEliminar(respuesta) {
    if (respuesta === "S") {
        let id = MSGBOX.ventana.objeto.idpersona;
        let resp = BD.send(`cmd=eliminarPersonal&idpersona=${id}`);
        cargarTabla(); // Recargar la tabla luego de eliminar
    }
    MSGBOX.ventana.HideInfo();
}
